import{j as o,r as _,u as f}from"./index-C96PFSvo.js";import{L as y,P as x,B as I}from"./index-CL5EgAiU.js";import{h as u,s as v}from"./http-Bwthace3.js";import{i as b}from"./validate-lzbhNUC4.js";import"./row-DSK-Iw-y.js";import"./index-kaDW5-9q.js";import"./TextArea-C947t_Q3.js";async function w(r,n){try{const a=r.pageSize,e=r.current,t={params:{page_size:a,current:e,...n}},s=(await u.get("/api/device",t)).data,c=!s.status_code,l=s.device_list,p=b(l)?l:[l],m=p.length();return{data:p.map((i,h)=>({id:h+1,user_id:i.owenr.id,device_id:i.id?i.id:0,owner:i.owner.name?i.owner.name:"无",address:i.address?i.address:"无",phone_number:i.owner.phone_number,device_name:i.device_name?i.device_name:"无",device_status:i.device_status})),success:c,total:m}}catch{}}async function R(r,n){const a=r.user_id,e=r.device_name,t=Number(r.device_status);try{const d={user_id:a,deice_name:e,device_status:t,token:n};await u.post("/api/device/add",d)}catch{}}async function q(r,n,a){const e=Number(n.device_id),t=r.user_id,d=r.device_name,s=Number(r.device_status);try{const c={device_id:e,user_id:t,deice_name:d,device_status:s,token:a};await u.post("/api/device/update",c)}catch{}}async function g(r,n,a){const e=n.device_id;try{const t={device_id:e,token:a};await u.post("/api/device/delete",t)}catch{}}function D(){return[{title:"设备ID",dataIndex:"device_id",hideInForm:!0,required:!0,valueType:"digit"},{title:"用户ID",dataIndex:"user_id",hideInTable:!0,hideInSearch:!0,required:!0,valueType:"digit"},{title:"设备所有人",dataIndex:"owner",hideInForm:!0},{title:"详细地址",dataIndex:"address",hideInForm:!0},{title:"手机号码",dataIndex:"phone_number",hideInForm:!0},{title:"设备名称",dataIndex:"device_name",required:!0},{title:"设备状态",dataIndex:"device_status",valueType:"radio",fieldProps:{options:[{label:"正常",value:1},{label:"维修中",value:2}]},required:!0},{title:"操作",valueType:"option",enableDelete:()=>({disabled:!1,visible:!0,danger:!0,btnText:"删除"}),render:(r,n,a,e,t)=>[o.jsx(y,{onClick:()=>{var d;return(d=t.current)==null?void 0:d.openModal("edit",n)},children:"编辑"},1)]}]}const S={new:"新增",edit:"编辑",read:"查看"};function C(){const r=_.useRef(null),n=_.useRef(null),{token:a}=f();return o.jsx("div",{children:o.jsx(x,{name:"设备管理",columns:D(),request:(e,t)=>w(e,t),bordered:!0,innerRef:r,actionRef:n,toolbar:{actions:[o.jsx(I,{type:"primary",onClick:()=>{var e;(e=r.current)==null||e.openModal()},children:"新增设备"},1)]},delFunction:async(e,t)=>await g(e,t,a),onFinish:async(e,t,d)=>{var s,c;t==="new"&&(await R(e,a),v.success("新建设备成功!"),(s=n.current)==null||s.reload()),t==="edit"&&(await q(e,d,a),v.success("编辑成功!"),(c=n.current)==null||c.reload())}})})}export{S as FORM_TYPE_MAP,C as default};
