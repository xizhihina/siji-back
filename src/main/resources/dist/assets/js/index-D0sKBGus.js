import{j as c,r as f}from"./index-BJ2M2YpL.js";import{L as I,P as x}from"./index-2Tawbro6.js";import{h as m,s as y}from"./http-GtRzVHx2.js";import{i as b}from"./validate-lzbhNUC4.js";import"./row-BqiG_bf7.js";import"./index-omGob3ob.js";import"./TextArea-VMYqHmOO.js";import"./Skeleton-Czt0UNwg.js";async function R(t,r){try{const{pageSize:a,current:n,...d}=t,s={params:{page_size:t.pageSize,current:n,...d}},l=(await m.get("/api/fault",s)).data,h=!l.status_code,u=l.fault,p=b(u)?u:[u],_=p.length;return{data:p.map((e,v)=>({id:v+1,fault_id:e.id,device_id:e.device.id?e.device.id:0,owner:e.device.owner.name?e.device.owner.name:"无",device_name:e.device.device_name?e.device.device_name:"无",address:e.device.address?e.device.address:"无",phone_number:e.device.owner.phone_number,description:e.description,create_time:e.create_time,status:e.status})),success:h,total:_}}catch{}}async function q(t,r){const a=Number(r.fault_id),n=Number(r.device_id),d=t.description,i=Number(t.status),s=t.create_time;try{const o={fault_id:a,device_id:n,description:d,status:i,create_time:s};await m.post("/api/fault/update",o)}catch{}}function T(){return[{title:"报修记录ID",dataIndex:"fault_id",hideInSearch:!0,hideInForm:!0,required:!0,valueType:"digit"},{title:"设备ID",dataIndex:"device_id",hideInForm:!0,required:!0,valueType:"digit"},{title:"报修人",dataIndex:"owner",hideInForm:!0},{title:"详细地址",dataIndex:"address",hideInForm:!0},{title:"手机号码",dataIndex:"phone_number",hideInForm:!0},{title:"设备名称",dataIndex:"device_name",hideInForm:!0},{title:"派单状态",dataIndex:"status",valueType:"radio",fieldProps:{options:[{label:"未处理",value:1},{label:"已派单",value:2}]},required:!0},{title:"故障描述",dataIndex:"description",valueType:"textarea",hideInSearch:!0,hideInTable:!0,required:!0},{title:"创建时间",dataIndex:"create_time",valueType:"dateTime",hideInSearch:!0,required:!0},{title:"操作",valueType:"option",enableDelete:!1,render:(t,r,a,n,d)=>[c.jsx(I,{onClick:()=>{var i;return(i=d.current)==null?void 0:i.openModal("edit",r)},children:"更新"},1)]}]}const N={new:"新增",edit:"编辑",read:"查看"};function E(){const t=f.useRef(null),r=f.useRef(null);return c.jsx("div",{children:c.jsx(x,{name:"故障报修",columns:T(),request:(a,n)=>R(a),bordered:!0,innerRef:t,actionRef:r,onFinish:async(a,n,d)=>{var i;n==="edit"&&(await q(a,d),y.success("编辑成功!"),(i=r.current)==null||i.reload())}})})}export{N as FORM_TYPE_MAP,E as default};
