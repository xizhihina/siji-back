import{j as u,r as m,u as w}from"./index-BJ2M2YpL.js";import{L as k,P as x}from"./index-2Tawbro6.js";import{h as l,s as v}from"./http-GtRzVHx2.js";import{i as y}from"./validate-lzbhNUC4.js";import"./row-BqiG_bf7.js";import"./index-omGob3ob.js";import"./TextArea-VMYqHmOO.js";import"./Skeleton-Czt0UNwg.js";async function b(a,n){try{const{pageSize:i,current:r,...t}=a,o={params:{page_size:a.pageSize,current:r,...t}},s=(await l.get("/api/work_order",o)).data,f=!s.status_code,c=s.work_order,_=y(c)?c:[c],h=_.length;return{data:_.map((e,I)=>({id:I+1,work_order_id:e.id?e.id:0,fault_id:e.fault.id?e.fault.id:0,maintenance_person_id:e.maintenance_person.id?e.maintenance_person.id:0,maintenance_person:e.maintenance_person.name?e.maintenance_person.name:"无",owner:e.fault.device.owner.name?e.fault.device.owner.name:"无",address:e.fault.device.address?e.fault.device.address:"无",device_name:e.fault.device.device_name?e.fault.device.device_name:"无",status:e.status,maintenance_time:e.maintenance_time})),success:f,total:h}}catch{}}async function R(a,n,i){const r=Number(n.work_order_id),t=Number(n.fault_id),d=Number(a.maintenance_person_id),o=a.maintenance_time,p=Number(a.status);try{const s={work_order_id:r,fault_id:t,maintenance_person_id:d,maintenance_time:o,status:p,token:i};await l.post("/api/work_order/update",s)}catch{}}async function T(a,n,i){const r=n.work_order_id;try{const t={work_order_id:r,token:i};await l.post("/api/work_order/delete",t)}catch{}}function g(){return[{title:"工单ID",dataIndex:"work_order_id",hideInForm:!0,required:!0,valueType:"digit"},{title:"故障ID",dataIndex:"fault_id",hideInTable:!0,hideInForm:!0,hideInSearch:!0,required:!0,valueType:"digit"},{title:"维修人员ID",dataIndex:"maintenance_person_id",hideInTable:!0,hideInSearch:!0,required:!0,valueType:"digit"},{title:"维修人",dataIndex:"maintenance_person",hideInForm:!0},{title:"设备所有人",dataIndex:"owner",hideInForm:!0},{title:"详细地址",dataIndex:"address",hideInForm:!0},{title:"设备名称",dataIndex:"device_name",hideInSearch:!0,hideInForm:!0},{title:"工单状态",dataIndex:"status",valueType:"radio",fieldProps:{options:[{label:"处理中",value:1},{label:"已完成",value:2}]},hideInSearch:!0,required:!0},{title:"创建时间",dataIndex:"maintenance_time",valueType:"dateTime",hideInSearch:!0,required:!0},{title:"操作",valueType:"option",enableDelete:()=>({disabled:!1,visible:!0,danger:!0,btnText:"删除"}),render:(a,n,i,r,t)=>[u.jsx(k,{onClick:()=>{var d;return(d=t.current)==null?void 0:d.openModal("edit",n)},children:"更新"},1)]}]}const E={new:"新增",edit:"编辑",read:"查看"};function B(){const a=m.useRef(null),n=m.useRef(null),{token:i}=w();return u.jsx("div",{children:u.jsx(x,{name:"工单管理",columns:g(),request:(r,t)=>b(r),bordered:!0,innerRef:a,actionRef:n,delFunction:async(r,t)=>await T(r,t,i),onFinish:async(r,t,d)=>{var o;t==="edit"&&(await R(r,d,i),v.success("编辑成功!"),(o=n.current)==null||o.reload())}})})}export{E as FORM_TYPE_MAP,B as default};
