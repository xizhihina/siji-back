import{j as o,r as _,u as x}from"./index-BJ2M2YpL.js";import{L as I,P as b,B as w}from"./index-2Tawbro6.js";import{h as u,s as m}from"./http-GtRzVHx2.js";import{i as R}from"./validate-lzbhNUC4.js";import"./row-BqiG_bf7.js";import"./index-omGob3ob.js";import"./TextArea-VMYqHmOO.js";import"./Skeleton-Czt0UNwg.js";async function q(r,a){try{const{pageSize:n,current:e,...t}=r,s={params:{page_size:r.pageSize,current:e,...t}},p=(await u.get("/api/device",s)).data,h=!p.status_code,l=p.device_list,v=R(l)?l:[l],f=v.length;return{data:v.map((d,y)=>({id:y+1,user_id:d.owner.id,device_id:d.id?d.id:0,owner:d.owner.name?d.owner.name:"无",address:d.address?d.address:"无",phone_number:d.owner.phone_number,device_name:d.device_name?d.device_name:"无",device_status:d.device_status})),success:h,total:f}}catch{}}async function g(r,a){const n=r.user_id,e=r.device_name,t=Number(r.device_status);try{const i={user_id:n,device_name:e,device_status:t,token:a};await u.post("/api/device/add",i)}catch{}}async function D(r,a,n){const e=Number(a.device_id),t=r.user_id,i=r.device_name,s=Number(r.device_status);try{const c={device_id:e,user_id:t,device_name:i,device_status:s,token:n};await u.post("/api/device/update",c)}catch{}}async function F(r,a,n){const e=a.device_id;try{const t={device_id:e,token:n};await u.post("/api/device/delete",t)}catch{}}function T(){return[{title:"设备ID",dataIndex:"device_id",hideInForm:!0,required:!0,valueType:"digit"},{title:"用户ID",dataIndex:"user_id",hideInTable:!0,hideInSearch:!0,required:!0,valueType:"digit"},{title:"设备所有人",dataIndex:"owner",hideInForm:!0},{title:"详细地址",dataIndex:"address",hideInForm:!0},{title:"手机号码",dataIndex:"phone_number",hideInForm:!0},{title:"设备名称",dataIndex:"device_name",required:!0},{title:"设备状态",dataIndex:"device_status",valueType:"radio",fieldProps:{options:[{label:"正常",value:1},{label:"维修中",value:2}]},required:!0},{title:"操作",valueType:"option",enableDelete:()=>({disabled:!1,visible:!0,danger:!0,btnText:"删除"}),render:(r,a,n,e,t)=>[o.jsx(I,{onClick:()=>{var i;return(i=t.current)==null?void 0:i.openModal("edit",a)},children:"编辑"},1)]}]}const E={new:"新增",edit:"编辑",read:"查看"};function L(){const r=_.useRef(null),a=_.useRef(null),{token:n}=x();return o.jsx("div",{children:o.jsx(b,{name:"设备管理",columns:T(),request:(e,t)=>q(e),bordered:!0,innerRef:r,actionRef:a,toolbar:{actions:[o.jsx(w,{type:"primary",onClick:()=>{var e;(e=r.current)==null||e.openModal()},children:"新增设备"},1)]},delFunction:async(e,t)=>await F(e,t,n),onFinish:async(e,t,i)=>{var s,c;t==="new"&&(await g(e,n),m.success("新建设备成功!"),(s=a.current)==null||s.reload()),t==="edit"&&(await D(e,i,n),m.success("编辑成功!"),(c=a.current)==null||c.reload())}})})}export{E as FORM_TYPE_MAP,L as default};
