import{j as c,r as p}from"./index-C96PFSvo.js";import{L as v,P as _}from"./index-CL5EgAiU.js";import{h as m,s as I}from"./http-Bwthace3.js";import{i as x}from"./validate-lzbhNUC4.js";import"./row-DSK-Iw-y.js";import"./index-kaDW5-9q.js";import"./TextArea-C947t_Q3.js";async function y(t,r){try{const a=t.pageSize,n=t.current,d={params:{page_size:a,current:n,...r}},s=(await m.get("/api/fault",d)).data,o=!s.status_code,u=s.fault,l=x(u)?u:[u],f=l.length();return{data:l.map((e,h)=>({id:h+1,fault_id:e.id,device_id:e.device.id?e.device.id:0,owner:e.device.owner.name?e.device.owner.name:"无",device_name:e.device.device_name?e.device.device_name:"无",address:e.device.address?e.device.address:"无",phone_number:e.device.owner.phone_number,description:e.description,create_time:e.create_time,status:e.status})),success:o,total:f}}catch{}}async function b(t,r){const a=Number(r.fault_id),n=Number(r.device_id),d=t.description,i=Number(t.status),s=t.create_time;try{const o={fault_id:a,device_id:n,description:d,status:i,create_time:s};await m.post("/api/fault/update",o)}catch{}}function R(){return[{title:"报修记录ID",dataIndex:"fault_id",hideInSearch:!0,hideInForm:!0,required:!0,valueType:"digit"},{title:"设备ID",dataIndex:"device_id",hideInForm:!0,required:!0,valueType:"digit"},{title:"报修人",dataIndex:"owner",hideInForm:!0},{title:"详细地址",dataIndex:"address",hideInForm:!0},{title:"手机号码",dataIndex:"phone_number",hideInForm:!0},{title:"设备名称",dataIndex:"device_name",hideInForm:!0},{title:"派单状态",dataIndex:"status",valueType:"radio",fieldProps:{options:[{label:"未处理",value:1},{label:"已派单",value:2}]},required:!0},{title:"故障描述",dataIndex:"description",valueType:"textarea",hideInSearch:!0,hideInTable:!0,required:!0},{title:"创建时间",dataIndex:"create_time",valueType:"dateTime",hideInSearch:!0,required:!0},{title:"操作",valueType:"option",enableDelete:!1,render:(t,r,a,n,d)=>[c.jsx(v,{onClick:()=>{var i;return(i=d.current)==null?void 0:i.openModal("edit",r)},children:"更新"},1)]}]}const S={new:"新增",edit:"编辑",read:"查看"};function M(){const t=p.useRef(null),r=p.useRef(null);return c.jsx("div",{children:c.jsx(_,{name:"故障报修",columns:R(),request:(a,n)=>y(a,n),bordered:!0,innerRef:t,actionRef:r,rowSelection:{},onFinish:async(a,n,d)=>{var i;n==="edit"&&(await b(a,d),I.success("编辑成功!"),(i=r.current)==null||i.reload())}})})}export{S as FORM_TYPE_MAP,M as default};
