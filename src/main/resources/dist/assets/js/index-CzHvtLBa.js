import{j as u,r as p,u as h}from"./index-C96PFSvo.js";import{L as I,P as w}from"./index-CL5EgAiU.js";import{h as l,s as k}from"./http-Bwthace3.js";import{i as x}from"./validate-lzbhNUC4.js";import"./row-DSK-Iw-y.js";import"./index-kaDW5-9q.js";import"./TextArea-C947t_Q3.js";async function v(a,r){try{const i=a.pageSize,n=a.current,t={params:{page_size:i,current:n,...r}},o=(await l.get("/api/work_order",t)).data,c=!o.status_code,s=o.work_order,_=x(s)?s:[s],m=_.length();return{data:_.map((e,f)=>({id:f+1,work_order_id:e.id?e.id:0,fault_id:e.fault.id?e.fault.id:0,maintenance_person_id:e.maintenance_person.id?e.maintenance_person.id:0,maintenance_person:e.maintenance_person.name?e.maintenance_person.name:"无",owner:e.fault.device.owner.name?e.fault.device.owner.name:"无",address:e.fault.device.owner.address?e.fault.device.owner.address:"无",device_name:e.fault.device.device_name?e.fault.device.device_name:"无",status:e.status,maintenance_time:e.maintenance_time})),success:c,total:m}}catch{}}async function y(a,r,i){const n=Number(r.work_order_id),t=Number(r.fault_id),d=Number(a.maintenance_person_id),o=a.maintenance_time,c=Number(a.status);try{const s={work_order_id:n,fault_id:t,maintenance_person_id:d,maintenance_time:o,status:c,token:i};await l.post("/api/work_order/update",s)}catch{}}async function b(a,r,i){const n=r.work_order_id;try{const t={work_order_id:n,token:i};await l.post("/api/work_order/delete",t)}catch{}}function R(){return[{title:"工单ID",dataIndex:"work_order_id",hideInForm:!0,required:!0,valueType:"digit"},{title:"故障ID",dataIndex:"fault_id",hideInTable:!0,hideInForm:!0,hideInSearch:!0,required:!0,valueType:"digit"},{title:"维修人员ID",dataIndex:"maintenance_person_id",hideInTable:!0,hideInSearch:!0,required:!0,valueType:"digit"},{title:"维修人",dataIndex:"maintenance_person",hideInForm:!0},{title:"设备所有人",dataIndex:"owner",hideInForm:!0},{title:"详细地址",dataIndex:"address",hideInForm:!0},{title:"设备名称",dataIndex:"device_name",hideInSearch:!0,hideInForm:!0},{title:"工单状态",dataIndex:"status",valueType:"radio",fieldProps:{options:[{label:"处理中",value:1},{label:"已完成",value:2}]},hideInSearch:!0,required:!0},{title:"创建时间",dataIndex:"maintenance_time",valueType:"dateTime",hideInSearch:!0,required:!0},{title:"操作",valueType:"option",enableDelete:()=>({disabled:!1,visible:!0,danger:!0,btnText:"删除"}),render:(a,r,i,n,t)=>[u.jsx(I,{onClick:()=>{var d;return(d=t.current)==null?void 0:d.openModal("edit",r)},children:"更新"},1)]}]}const P={new:"新增",edit:"编辑",read:"查看"};function M(){const a=p.useRef(null),r=p.useRef(null),{token:i}=h();return u.jsx("div",{children:u.jsx(w,{name:"工单管理",columns:R(),request:(n,t)=>v(n,t),bordered:!0,innerRef:a,actionRef:r,delFunction:async(n,t)=>await b(n,t,i),onFinish:async(n,t,d)=>{var o;t==="edit"&&(await y(n,d,i),k.success("编辑成功!"),(o=r.current)==null||o.reload())}})})}export{P as FORM_TYPE_MAP,M as default};
